<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìº í•‘ì¥ ë¦¬ë·° ì‘ì„±</title>
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/review-form.css}">
</head>
<body>
    <!-- ë¡œê·¸ì¸ ì „ ìƒë‹¨ ë©”ë‰´ -->
    <div th:replace="~{fragments/topmenu :: beforeLoginTop}"></div>

    <!-- ë¡œê·¸ì¸ í›„ ìƒë‹¨ ë©”ë‰´ -->
    <div th:replace="~{fragments/topmenu :: afterLoginTop}"></div>

    <!-- ê³µí†µ í—¤ë” ì˜ì—­ -->
    <div th:replace="~{fragments/topmenu :: header}"></div>

    <div class="yanolja-review-container">
        <!-- ìº í•‘ì¥ ì •ë³´ í—¤ë” -->
        <div class="camping-header">
            <div class="camping-info">
                <h1 th:text="${camping.facltNm}">ìº í•‘ì¥ ì´ë¦„</h1>
                <p class="camping-location" th:text="${camping.addr1}">ìº í•‘ì¥ ìœ„ì¹˜</p>
            </div>
            <div class="camping-rating">
                <div class="rating-display">
                    <span class="rating-score" th:text="${averageRating != null ? averageRating : '0.0'}">4.8</span>
                </div>
                <div class="rating-stars">
                    <span class="star filled">â˜…</span>
                    <span class="star filled">â˜…</span>
                    <span class="star filled">â˜…</span>
                    <span class="star filled">â˜…</span>
                    <span class="star">â˜…</span>
                </div>
            </div>
        </div>

        <!-- ë¦¬ë·° ì‘ì„± í¼ -->
        <div class="review-form-section">
            <div class="form-container">
                <h2>ë¦¬ë·° ì‘ì„±</h2>
                
                <form th:action="@{/reviews}" th:object="${reviewForm}" method="post" class="yanolja-review-form" enctype="multipart/form-data">
                    <input type="hidden" name="campingId" th:value="${camping.contentId}">
                    <input type="hidden" name="revId" th:value="${review?.revId}" />

                    <!-- í‰ì  ì„ íƒ -->
                    <div class="rating-input-section">
                        <h3>í‰ì </h3>
                        <div class="rating-input">
                            <div class="star-input">
                                <input type="radio" id="star5" name="score" value="5" th:checked="${review?.score == 5}">
                                <label for="star5">â˜…</label>
                                <input type="radio" id="star4" name="score" value="4" th:checked="${review?.score == 4}">
                                <label for="star4">â˜…</label>
                                <input type="radio" id="star3" name="score" value="3" th:checked="${review?.score == 3}">
                                <label for="star3">â˜…</label>
                                <input type="radio" id="star2" name="score" value="2" th:checked="${review?.score == 2}">
                                <label for="star2">â˜…</label>
                                <input type="radio" id="star1" name="score" value="1" th:checked="${review?.score == 1}">
                                <label for="star1">â˜…</label>
                            </div>
                            <span class="rating-text">í‰ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</span>
                        </div>
                    </div>

                    <!-- í•œëˆˆì— ë³´ëŠ” íŠ¹ì§• -->
                    <div class="features-section">
                        <h3>í•œëˆˆì— ë³´ëŠ” íŠ¹ì§•</h3>
                        <p class="features-subtitle">499ëª… ì°¸ì—¬</p>
                        <div class="features-grid">
                            <label class="feature-item">
                                <input type="checkbox" name="features" value="clean">
                                <span class="feature-text">ê°ì‹¤ì´ ê¹¨ë—í•´ìš”</span>
                                <span class="feature-count">359</span>
                            </label>
                            <label class="feature-item">
                                <input type="checkbox" name="features" value="bedding">
                                <span class="feature-text">ì¹¨êµ¬ê°€ ì¢‹ì•„ìš”</span>
                                <span class="feature-count">314</span>
                            </label>
                            <label class="feature-item">
                                <input type="checkbox" name="features" value="service">
                                <span class="feature-text">ê³ ê° ì‘ëŒ€ê°€ ì¹œì ˆí•´ìš”</span>
                                <span class="feature-count">286</span>
                            </label>
                            <label class="feature-item">
                                <input type="checkbox" name="features" value="view">
                                <span class="feature-text">ì „ë§ì´ ì¢‹ì•„ìš”</span>
                                <span class="feature-count">225</span>
                            </label>
                            <label class="feature-item">
                                <input type="checkbox" name="features" value="parking">
                                <span class="feature-text">ì£¼ì°¨í•˜ê¸° í¸í•´ìš”</span>
                                <span class="feature-count">207</span>
                            </label>
                            <label class="feature-item">
                                <input type="checkbox" name="features" value="breakfast">
                                <span class="feature-text">ì¡°ì‹ì´ ë§›ìˆì–´ìš”</span>
                                <span class="feature-count">165</span>
                            </label>
                            <label class="feature-item">
                                <input type="checkbox" name="features" value="facilities">
                                <span class="feature-text">ë¶€ëŒ€ì‹œì„¤ì„ ì˜ ê°–ì·„ì–´ìš”</span>
                                <span class="feature-count">132</span>
                            </label>
                            <label class="feature-item">
                                <input type="checkbox" name="features" value="amenity">
                                <span class="feature-text">ì–´ë©”ë‹ˆí‹°ê°€ ì¢‹ì•„ìš”</span>
                                <span class="feature-count">67</span>
                            </label>
                            <label class="feature-item">
                                <input type="checkbox" name="features" value="family">
                                <span class="feature-text">ì•„ì´ì™€ ê°€ê¸° ì¢‹ì•„ìš”</span>
                                <span class="feature-count">54</span>
                            </label>
                            <label class="feature-item">
                                <input type="checkbox" name="features" value="pool">
                                <span class="feature-text">ìˆ˜ì˜ì¥ì´ ì¢‹ì•„ìš”</span>
                                <span class="feature-count">39</span>
                            </label>
                        </div>
                    </div>

                    <!-- ì‚¬ì§„ ì—…ë¡œë“œ -->
                    <div class="photo-section">
                        <h3>ì‚¬ì§„ í›„ê¸°</h3>
                        <div class="photo-upload-area">
                            <div class="photo-grid" id="photoGrid">
                                <div class="photo-upload-item" onclick="document.getElementById('photoInput').click()">
                                    <div class="upload-icon">ğŸ“·</div>
                                    <span>ì‚¬ì§„ ì¶”ê°€</span>
                                    <span class="upload-limit">ìµœëŒ€ 10ì¥</span>
                                </div>
                            </div>
                            <input type="file" id="photoInput" name="photos" multiple accept="image/*" style="display: none;">
                        </div>
                    </div>

                    <!-- ë¦¬ë·° ë‚´ìš© -->
                    <div class="content-section">
                        <h3>ë¦¬ë·° ë‚´ìš©</h3>
                        <textarea 
                            id="content" 
                            name="content" 
                            th:field="*{content}"
                            placeholder="ìº í•‘ì¥ì— ëŒ€í•œ ì†”ì§í•œ í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”..."
                            required
                            minlength="10"
                            maxlength="2000"></textarea>
                        <div class="char-count">
                            <span id="currentCount">0</span> / 2000
                        </div>
                    </div>

                    <!-- ë²„íŠ¼ ì˜ì—­ -->
                    <div class="form-buttons">
                        <button type="button" class="cancel-btn" onclick="goBack()">ì·¨ì†Œ</button>
                        <button type="submit" class="submit-btn" th:text="${review != null ? 'ìˆ˜ì •' : 'ë“±ë¡'}">ë“±ë¡</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // í‰ì  ì„ íƒ ì‹œ í…ìŠ¤íŠ¸ ë³€ê²½
        document.querySelectorAll('input[name="score"]').forEach(input => {
            input.addEventListener('change', function() {
                const ratingText = document.querySelector('.rating-text');
                const score = this.value;
                const texts = {
                    '5': 'ë§¤ìš° ë§Œì¡±',
                    '4': 'ë§Œì¡±',
                    '3': 'ë³´í†µ',
                    '2': 'ë¶ˆë§Œì¡±',
                    '1': 'ë§¤ìš° ë¶ˆë§Œì¡±'
                };
                ratingText.textContent = texts[score] || 'í‰ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
            });
        });

        // ê¸€ì ìˆ˜ ì¹´ìš´íŠ¸
        document.getElementById('content').addEventListener('input', function() {
            const currentLength = this.value.length;
            document.getElementById('currentCount').textContent = currentLength;
            
            const charCount = document.querySelector('.char-count');
            if (currentLength > 1800) {
                charCount.style.color = '#dc3545';
            } else if (currentLength > 1600) {
                charCount.style.color = '#ffc107';
            } else {
                charCount.style.color = '#6c757d';
            }
        });

        // ì‚¬ì§„ ì—…ë¡œë“œ ì²˜ë¦¬
        document.getElementById('photoInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            const photoGrid = document.getElementById('photoGrid');
            const uploadItem = photoGrid.querySelector('.photo-upload-item');
            
            // ê¸°ì¡´ ì‚¬ì§„ë“¤ ì œê±° (ì—…ë¡œë“œ ì•„ì´í…œ ì œì™¸)
            const existingPhotos = photoGrid.querySelectorAll('.photo-item');
            existingPhotos.forEach(photo => photo.remove());
            
            files.forEach((file, index) => {
                if (index >= 10) return; // ìµœëŒ€ 10ì¥ ì œí•œ
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-item';
                    photoItem.innerHTML = `
                        <img src="${e.target.result}" alt="ì—…ë¡œë“œëœ ì‚¬ì§„">
                        <button type="button" class="remove-photo" onclick="removePhoto(this)">Ã—</button>
                    `;
                    photoGrid.insertBefore(photoItem, uploadItem);
                };
                reader.readAsDataURL(file);
            });
        });

        // ì‚¬ì§„ ì œê±°
        function removePhoto(button) {
            button.parentElement.remove();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ê¸€ì ìˆ˜ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            const textarea = document.getElementById('content');
            const currentLength = textarea.value.length;
            document.getElementById('currentCount').textContent = currentLength;
        });

        // ë’¤ë¡œ ê°€ê¸°
        function goBack() {
            const campingId = document.querySelector('input[name="campingId"]').value;
            window.location.href = `/camping/${campingId}`;
        }

        // í¼ ì œì¶œ ì „ ìœ íš¨ì„± ê²€ì‚¬
        document.querySelector('.yanolja-review-form').addEventListener('submit', function(e) {
            const score = document.querySelector('input[name="score"]:checked');
            const content = document.getElementById('content').value.trim();

            if (!score) {
                e.preventDefault();
                alert('í‰ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!content || content.length < 10) {
                e.preventDefault();
                alert('ë¦¬ë·° ë‚´ìš©ì€ ìµœì†Œ 10ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
        });
    </script>
</body>
</html> 