<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìº í•‘ì¥ ë¦¬ë·° ì‘ì„±</title>
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/review-form.css}">
</head>
<body>
<div th:replace="~{fragments/topmenu :: beforeLoginTop}"></div>

<div th:replace="~{fragments/topmenu :: afterLoginTop}"></div>

<div th:replace="~{fragments/topmenu :: header}"></div>
<th:block th:replace="~{fragments/toolbar :: scrollingToolbar}"></th:block>

<div class="yanolja-review-container">
    <div class="camping-header">
        <div class="camping-info">
            <h1 th:text="${camping.facltNm}">ìº í•‘ì¥ ì´ë¦„</h1>
            <p class="camping-location" th:text="${camping.addr1}">ìº í•‘ì¥ ìœ„ì¹˜</p>
        </div>
        <div class="camping-rating">
            <div class="rating-display">
                <span class="rating-score" th:text="${averageRating != null ? #numbers.formatDecimal(averageRating, 1, 1) : '0.0'}">4.8</span>
            </div>
            <div class="rating-stars">
                <span class="star filled">â˜…</span>
                <span class="star filled">â˜…</span>
                <span class="star filled">â˜…</span>
                <span class="star filled">â˜…</span>
                <span class="star">â˜…</span>
            </div>
        </div>
    </div>

    <div class="review-form-section">
        <div class="form-container">
            <h2>ë¦¬ë·° ì‘ì„±</h2>

            <form th:action="@{/reviews/write}" th:object="${reviewForm}" method="post" class="yanolja-review-form" enctype="multipart/form-data">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <input type="hidden" name="campingId" th:value="${camping.contentId}">

                <div class="rating-input-section">
                    <h3>í‰ì </h3>
                    <div class="rating-input">
                        <div class="star-input">
                            <input type="radio" id="star5" name="score" value="5">
                            <label for="star5">â˜…</label>
                            <input type="radio" id="star4" name="score" value="4">
                            <label for="star4">â˜…</label>
                            <input type="radio" id="star3" name="score" value="3">
                            <label for="star3">â˜…</label>
                            <input type="radio" id="star2" name="score" value="2">
                            <label for="star2">â˜…</label>
                            <input type="radio" id="star1" name="score" value="1" checked> <label for="star1">â˜…</label>
                        </div>
                        <span class="rating-text">í‰ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</span>
                    </div>
                </div>

                <div class="features-section">
                    <h3>í•œëˆˆì— ë³´ëŠ” íŠ¹ì§•</h3>
                    <div class="features-grid">
                        <label class.feature-item th:each="keyword : ${allKeywords}">
                            <input type="checkbox" name="keywordIds" th:value="${keyword.keywordId}">
                            <span class="feature-text" th:text="${keyword.words}">í‚¤ì›Œë“œ ì´ë¦„</span>
                        </label>
                    </div>
                </div>

                <div class="photo-section">
                    <h3>ì‚¬ì§„ í›„ê¸°</h3>
                    <div class="photo-upload-area">
                        <div class="photo-grid" id="photoGrid">
                            <div class="photo-upload-item" onclick="document.getElementById('photoInput').click()">
                                <div class="upload-icon">ğŸ“·</div>
                                <span>ì‚¬ì§„ ì¶”ê°€</span>
                                <span class="upload-limit">ìµœëŒ€ 10ì¥</span>
                            </div>
                        </div>
                        <input type="file" id="photoInput" name="imageFiles" multiple accept="image/*" style="display: none;">
                    </div>
                </div>

                <div class="content-section">
                    <h3>ë¦¬ë·° ë‚´ìš©</h3>
                    <textarea
                        id="content"
                        name="content"
                        th:field="*{content}"
                        placeholder="ìº í•‘ì¥ì— ëŒ€í•œ ì†”ì§í•œ í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”..."
                        required
                        minlength="10"
                        maxlength="2000"></textarea>
                    <div class="char-count">
                        <span id="currentCount">0</span> / 2000
                    </div>
                </div>

                <div class="form-buttons">
                    <button type="button" class="cancel-btn" onclick="history.back()">ì·¨ì†Œ</button>
                    <button type="submit" class="submit-btn">ë“±ë¡</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script th:inline="javascript">
    // í‰ì  ì„ íƒ ì‹œ í…ìŠ¤íŠ¸ ë³€ê²½
    document.querySelectorAll('input[name="score"]').forEach(input => {
        input.addEventListener('change', function() {
            const ratingText = document.querySelector('.rating-text');
            const score = this.value;
            const texts = {
                '5': 'ë§¤ìš° ë§Œì¡±',
                '4': 'ë§Œì¡±',
                '3': 'ë³´í†µ',
                '2': 'ë¶ˆë§Œì¡±',
                '1': 'ë§¤ìš° ë¶ˆë§Œì¡±'
            };
            ratingText.textContent = texts[score] || 'í‰ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
        });
    });

    // ê¸€ì ìˆ˜ ì¹´ìš´íŠ¸
    document.getElementById('content').addEventListener('input', function() {
        const currentLength = this.value.length;
        document.getElementById('currentCount').textContent = currentLength;
    });

    // ì‚¬ì§„ ì—…ë¡œë“œ ë¯¸ë¦¬ë³´ê¸° ì²˜ë¦¬
    document.getElementById('photoInput').addEventListener('change', function(e) {
        const files = Array.from(e.target.files);
        const photoGrid = document.getElementById('photoGrid');
        const uploadItem = photoGrid.querySelector('.photo-upload-item');

        // ê¸°ì¡´ ë¯¸ë¦¬ë³´ê¸° ì‚¬ì§„ë“¤ ì œê±° (ì—…ë¡œë“œ ì•„ì´í…œ ì œì™¸)
        const existingPhotos = photoGrid.querySelectorAll('.photo-item');
        existingPhotos.forEach(photo => photo.remove());

        files.forEach((file, index) => {
            if (index >= 10) return; // ìµœëŒ€ 10ì¥ ì œí•œ

            const reader = new FileReader();
            reader.onload = function(e) {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                photoItem.innerHTML = `
                    <img src="${e.target.result}" alt="ì—…ë¡œë“œëœ ì‚¬ì§„">
                `;
                photoGrid.insertBefore(photoItem, uploadItem);
            };
            reader.readAsDataURL(file);
        });
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ê¸€ì ìˆ˜ ì„¤ì •
    document.addEventListener('DOMContentLoaded', function() {
        const textarea = document.getElementById('content');
        if(textarea) {
            const currentLength = textarea.value.length;
            document.getElementById('currentCount').textContent = currentLength;
        }
    });
</script>
</body>
</html>